<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø© | Shefaa Pro Admin</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        :root {
            --main: #0d47a1; 
            --active: #1565c0;
            --bg: #f4f6f9;
            --text: #333;
            --sidebar-width: 260px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Cairo', sans-serif; background: var(--bg); color: var(--text); overflow-x: hidden; }

        /* --- 1. Ø´Ø§Ø´Ø© Ø§Ù„Ù‚ÙÙ„ (Login Overlay) --- */
        #loginOverlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, #000428, #004e92);
            z-index: 9999;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            color: white;
            transition: opacity 0.5s;
        }
        .login-box {
            background: rgba(255,255,255,0.1); padding: 40px; border-radius: 20px;
            backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2);
            text-align: center; width: 320px;
        }
        .login-box input {
            width: 100%; padding: 12px; margin: 15px 0; border-radius: 30px; border: none;
            text-align: center; font-family: 'Cairo'; outline: none;
        }
        .login-btn {
            background: var(--main); color: white; padding: 10px 40px; border-radius: 30px;
            border: none; cursor: pointer; font-weight: bold; font-family: 'Cairo';
            box-shadow: 0 5px 15px rgba(0,0,0,0.3); transition: 0.3s;
        }
        .login-btn:hover { transform: scale(1.05); background: #fff; color: var(--main); }

        /* --- 2. Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ (Sidebar + Content) --- */
        .wrapper { display: flex; min-height: 100vh; display: none; /* Ù…Ø®ÙÙŠ Ø­ØªÙ‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ */ }

        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width); background: #fff; position: fixed; right: 0; top: 0; height: 100%;
            box-shadow: -5px 0 20px rgba(0,0,0,0.05); padding: 20px; z-index: 100;
            transition: 0.3s;
        }
        .brand {
            display: flex; align-items: center; gap: 10px; margin-bottom: 40px; color: var(--main);
            padding-bottom: 20px; border-bottom: 1px solid #eee;
        }
        .brand i { font-size: 2em; }
        .brand h2 { font-weight: 900; margin: 0; }

        .menu-item {
            padding: 15px; border-radius: 12px; color: #777; cursor: pointer;
            display: flex; align-items: center; gap: 15px; margin-bottom: 10px;
            transition: 0.3s; font-weight: 600;
        }
        .menu-item:hover, .menu-item.active {
            background: #e3f2fd; color: var(--main);
        }

        /* Main Content */
        .main-content {
            flex: 1; margin-right: var(--sidebar-width); padding: 30px;
            transition: 0.3s;
        }

        .header-bar {
            display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;
        }
        .page-title { font-size: 1.8em; font-weight: bold; color: #2c3e50; }

        /* Cards */
        .stats-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 20px; margin-bottom: 30px;
        }
        .stat-card {
            background: white; padding: 25px; border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05); display: flex; align-items: center; gap: 20px;
        }
        .icon-box {
            width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-size: 1.5em; color: white;
        }
        
        /* Forms */
        .admin-card { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        input, select, textarea {
            width: 100%; padding: 12px; border: 1px solid #eee; border-radius: 10px;
            font-family: 'Cairo'; margin-bottom: 15px; outline: none; transition: 0.3s;
        }
        input:focus { border-color: var(--main); }
        .full-width { grid-column: span 2; }
        
        .action-btn {
            background: var(--main); color: white; padding: 12px 30px; border: none; border-radius: 10px;
            cursor: pointer; font-weight: bold; font-size: 1em; width: 100%;
        }

        /* Tables */
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th { text-align: right; color: #777; padding: 15px; border-bottom: 2px solid #eee; }
        td { padding: 15px; border-bottom: 1px solid #eee; vertical-align: middle; }
        .btn-sm { padding: 5px 10px; border-radius: 5px; border: none; cursor: pointer; color: white; font-size: 0.8em; margin-left: 5px; }
        .btn-del { background: #ff5252; }
        .btn-edit { background: #4caf50; }

        /* Sections Logic */
        .section { display: none; animation: fadeIn 0.4s; }
        .section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .sidebar { transform: translateX(100%); width: 100%; }
            .sidebar.open { transform: translateX(0); }
            .main-content { margin-right: 0; }
            .menu-toggle { display: block; font-size: 1.5em; cursor: pointer; }
        }
    </style>
</head>
<body>

    <div id="loginOverlay">
        <div class="login-box">
            <i class="fas fa-user-md fa-3x" style="margin-bottom: 20px;"></i>
            <h2>Ø¯ÙƒØªÙˆØ± Ø®Ø§Ù„Ø¯ | Admin</h2>
            <p style="font-size: 0.9em; opacity: 0.8; margin-bottom: 20px;">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ©</p>
            <input type="password" id="adminPass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
            <button class="login-btn" onclick="checkLogin()">Ø¯Ø®ÙˆÙ„ Ø¢Ù…Ù† ğŸ”’</button>
        </div>
    </div>

    <div class="wrapper" id="adminWrapper">
        
        <aside class="sidebar" id="sidebar">
            <div class="brand">
                <i class="fas fa-clinic-medical"></i>
                <div>
                    <h2>Shefaa Pro</h2>
                    <span style="font-size:0.7em; color:#777;">Control Panel v2.0</span>
                </div>
            </div>

            <div class="menu-item active" onclick="nav('dashboard', this)">
                <i class="fas fa-chart-pie"></i> Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©
            </div>
            <div class="menu-item" onclick="nav('add-drug', this)">
                <i class="fas fa-pills"></i> Ø¥Ø¶Ø§ÙØ© Ø¯ÙˆØ§Ø¡ Ø¬Ø¯ÙŠØ¯
            </div>
            <div class="menu-item" onclick="nav('comments', this)">
                <i class="fas fa-comments"></i> ØªØ¹Ù„ÙŠÙ‚Ø§Øª Ø§Ù„Ø²ÙˆØ§Ø±
            </div>
            <div class="menu-item" onclick="nav('settings', this)">
                <i class="fas fa-cog"></i> Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
            </div>
            <div class="menu-item" onclick="window.location.href='index.html'" style="margin-top: 50px; color: #ff5252;">
                <i class="fas fa-sign-out-alt"></i> Ø®Ø±ÙˆØ¬ Ù„Ù„Ù…ÙˆÙ‚Ø¹
            </div>
        </aside>

        <main class="main-content">
            <div class="header-bar">
                <i class="fas fa-bars menu-toggle" onclick="toggleSidebar()" style="display:none"></i>
                <div class="page-title" id="pageTitle">Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©</div>
                <div style="display:flex; align-items:center; gap:10px;">
                    <div style="text-align:left;">
                        <div style="font-weight:bold;">Dr. Khaled Shelil</div>
                        <div style="font-size:0.8em; color:green;">â— Online</div>
                    </div>
                    <img src="logo.png" style="width:45px; height:45px; border-radius:50%; border:2px solid #eee;">
                </div>
            </div>

            <section id="dashboard" class="section active">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="icon-box" style="background:#4facfe;"><i class="fas fa-users"></i></div>
                        <div>
                            <h3 id="usersCount">0</h3>
                            <span style="color:#777;">Ø¹Ø¯Ø¯ Ø§Ù„Ø²ÙˆØ§Ø±</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="icon-box" style="background:#f093fb;"><i class="fas fa-comment-dots"></i></div>
                        <div>
                            <h3 id="commentsCount">0</h3>
                            <span style="color:#777;">Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="icon-box" style="background:#43e97b;"><i class="fas fa-capsules"></i></div>
                        <div>
                            <h3>100+</h3>
                            <span style="color:#777;">Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</span>
                        </div>
                    </div>
                </div>

                <div class="admin-card">
                    <h3>ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ØªÙØ§Ø¹Ù„ (Ø£Ø³Ø¨ÙˆØ¹ÙŠ)</h3>
                    <canvas id="myChart" style="max-height: 300px;"></canvas>
                </div>
            </section>

            <section id="add-drug" class="section">
                <div class="admin-card">
                    <h3><i class="fas fa-plus-circle"></i> Ø¥Ø¯Ø®Ø§Ù„ Ø¯ÙˆØ§Ø¡ Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h3>
                    <p style="color:orange; font-size:0.9em; margin-bottom:20px;">* Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¯ÙˆØ§Ø¡ Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Firestore.</p>
                    
                    <div class="form-grid">
                        <input type="text" id="dN" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ§Ø¡ (Trade Name)">
                        <input type="text" id="dA" placeholder="Ø§Ù„Ù…Ø§Ø¯Ø© Ø§Ù„ÙØ¹Ø§Ù„Ø© (Active Ingredient)">
                        
                        <input type="number" id="dP" placeholder="Ø§Ù„Ø³Ø¹Ø± (Ø¬Ù†ÙŠØ©)">
                        <select id="dPreg">
                            <option value="A">Ø­Ù…Ù„: Ø¢Ù…Ù† (A)</option>
                            <option value="B">Ø­Ù…Ù„: Ø¢Ù…Ù† Ù†Ø³Ø¨ÙŠØ§Ù‹ (B)</option>
                            <option value="C">Ø­Ù…Ù„: ÙŠØ­ØªØ§Ø¬ Ø­Ø°Ø± (C)</option>
                            <option value="D">Ø­Ù…Ù„: Ø®Ø·Ø± (D)</option>
                            <option value="X">Ø­Ù…Ù„: Ù…Ù…Ù†ÙˆØ¹ (X)</option>
                        </select>

                        <textarea id="dU" class="full-width" placeholder="Ø¯ÙˆØ§Ø¹ÙŠ Ø§Ù„Ø§Ø³ØªØ¹Ù…Ø§Ù„..." rows="2"></textarea>
                        <textarea id="dDose" class="full-width" placeholder="Ø§Ù„Ø¬Ø±Ø¹Ø© Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©..." rows="2"></textarea>
                        
                        <button class="action-btn full-width" id="saveDrugBtn">Ø­ÙØ¸ Ø§Ù„Ø¯ÙˆØ§Ø¡ ÙÙŠ Ø§Ù„Ø³Ø­Ø§Ø¨Ø© â˜ï¸</button>
                    </div>
                </div>
            </section>

            <section id="comments" class="section">
                <div class="admin-card">
                    <h3>ğŸ’¬ ØªØ¹Ù„ÙŠÙ‚Ø§Øª ÙˆØ§Ø³ØªÙØ³Ø§Ø±Ø§Øª Ø§Ù„Ø²ÙˆØ§Ø±</h3>
                    <div id="commentsTableContainer">
                        <p>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>
                    </div>
                </div>
            </section>

             <section id="settings" class="section">
                <div class="admin-card">
                    <h3>âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø³Ø±ÙŠØ¹Ø©</h3>
                    <p>ÙŠÙ…ÙƒÙ†Ùƒ Ù‡Ù†Ø§ Ù…Ø³Ø­ Ø§Ù„ÙƒØ§Ø´ Ø£Ùˆ Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª.</p>
                    <br>
                    <button class="action-btn" style="background:#555; width:auto;" onclick="alert('Ù‚Ø±ÙŠØ¨Ø§Ù‹...')">ØªÙØ±ÙŠØº Ø§Ù„ÙƒØ§Ø´</button>
                </div>
            </section>

        </main>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, onSnapshot, orderBy, query } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ø´Ø±ÙˆØ¹Ùƒ Ø§Ù„Ø£ØµÙ„ÙŠØ©
        const firebaseConfig = {
            apiKey: "AIzaSyB7cYrnnhx_eBsV3IvhAJsM0kzK_I-zpUM",
            authDomain: "sheffa-pro.firebaseapp.com",
            projectId: "sheffa-pro",
            storageBucket: "sheffa-pro.firebasestorage.app",
            messagingSenderId: "542669946824",
            appId: "1:542669946824:web:f6c0826ee500344f278afd",
            measurementId: "G-XSQ9Q08JLQ"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // --- 1. Ù†Ø¸Ø§Ù… Ø§Ù„Ø¯Ø®ÙˆÙ„ ---
        window.checkLogin = function() {
            const p = document.getElementById('adminPass').value;
            if(p === "123456") { // ØªÙ‚Ø¯Ø± ØªØºÙŠØ± Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯ Ù‡Ù†Ø§
                document.getElementById('loginOverlay').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('loginOverlay').style.display = 'none';
                    document.getElementById('adminWrapper').style.display = 'flex';
                    initChart(); // ØªØ´ØºÙŠÙ„ Ø§Ù„Ø´Ø§Ø±Øª Ø¨Ø¹Ø¯ Ø§Ù„Ø¯Ø®ÙˆÙ„
                }, 500);
            } else {
                alert("Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯ Ø®Ø·Ø£!");
            }
        }

        // --- 2. Ø§Ù„ØªÙ†Ù‚Ù„ (Navigation) ---
        window.nav = function(id, el) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            
            document.querySelectorAll('.menu-item').forEach(m => m.classList.remove('active'));
            el.classList.add('active');

            // ØªØºÙŠÙŠØ± Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
            const titles = { 'dashboard': 'Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©', 'add-drug': 'Ø¥Ø¶Ø§ÙØ© Ø¯ÙˆØ§Ø¡', 'comments': 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª', 'settings': 'Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª' };
            document.getElementById('pageTitle').innerText = titles[id];

            // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙÙŠ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„
            if(window.innerWidth < 768) document.getElementById('sidebar').classList.remove('open');
        }

        window.toggleSidebar = function() {
            document.getElementById('sidebar').classList.toggle('open');
        }

        // --- 3. Ø¥Ø¶Ø§ÙØ© Ø¯ÙˆØ§Ø¡ Ø¬Ø¯ÙŠØ¯ (Firestore) ---
        document.getElementById('saveDrugBtn').addEventListener('click', async () => {
            const btn = document.getElementById('saveDrugBtn');
            btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...";
            
            try {
                // ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                const drugData = {
                    n: document.getElementById('dN').value, // name
                    a: document.getElementById('dA').value, // active
                    p: document.getElementById('dP').value, // price
                    u: document.getElementById('dU').value, // usage
                    dose: document.getElementById('dDose').value,
                    preg: document.getElementById('dPreg').value,
                    addedAt: new Date()
                };

                // Ø¥Ø±Ø³Ø§Ù„ Ù„ÙØ§ÙŠØ±Ø¨ÙŠØ³ (Ù…Ø¬Ù…ÙˆØ¹Ø© Ø¬Ø¯ÙŠØ¯Ø© Ø§Ø³Ù…Ù‡Ø§ drugs)
                await addDoc(collection(db, "drugs"), drugData);
                
                alert("âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¯ÙˆØ§Ø¡ Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠØ©!");
                btn.innerText = "Ø­ÙØ¸ Ø§Ù„Ø¯ÙˆØ§Ø¡ ÙÙŠ Ø§Ù„Ø³Ø­Ø§Ø¨Ø© â˜ï¸";
                // ØªÙØ±ÙŠØº Ø§Ù„Ø­Ù‚ÙˆÙ„
                document.querySelectorAll('input, textarea').forEach(i => i.value = '');
            } catch (e) {
                console.error(e);
                alert("âŒ Ø®Ø·Ø£: " + e.message);
                btn.innerText = "Ø­ÙØ¸ Ø§Ù„Ø¯ÙˆØ§Ø¡ ÙÙŠ Ø§Ù„Ø³Ø­Ø§Ø¨Ø© â˜ï¸";
            }
        });

        // --- 4. Ø¬Ù„Ø¨ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª (Realtime) ---
        const q = query(collection(db, "comments"), orderBy("time", "desc"));
        onSnapshot(q, (snapshot) => {
            let html = `<table><thead><tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„ØªØ¹Ù„ÙŠÙ‚</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>ØªØ­ÙƒÙ…</th></tr></thead><tbody>`;
            let count = 0;
            
            snapshot.forEach((docSnap) => {
                count++;
                const data = docSnap.data();
                const time = data.time ? new Date(data.time.seconds * 1000).toLocaleDateString('ar-EG') : '-';
                
                html += `
                    <tr>
                        <td style="font-weight:bold; color:var(--main)">${data.name}</td>
                        <td>${data.text}</td>
                        <td style="font-size:0.8em; color:#777;">${time}</td>
                        <td>
                            <button class="btn-sm btn-del" onclick="deleteComment('${docSnap.id}')"><i class="fas fa-trash"></i></button>
                        </td>
                    </tr>
                `;
            });
            html += `</tbody></table>`;
            
            if(count === 0) html = "<p style='text-align:center; padding:20px;'>Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ¹Ù„ÙŠÙ‚Ø§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†.</p>";
            
            document.getElementById('commentsTableContainer').innerHTML = html;
            document.getElementById('commentsCount').innerText = count;
        });

        // Ø¯Ø§Ù„Ø© Ø­Ø°Ù Ø§Ù„ØªØ¹Ù„ÙŠÙ‚
        window.deleteComment = async function(id) {
            if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚ØŸ")) {
                await deleteDoc(doc(db, "comments", id));
            }
        }

        // --- 5. Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ (Chart.js) ---
        function initChart() {
            const ctx = document.getElementById('myChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Ø§Ù„Ø³Ø¨Øª', 'Ø§Ù„Ø£Ø­Ø¯', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', 'Ø§Ù„Ø®Ù…ÙŠØ³', 'Ø§Ù„Ø¬Ù…Ø¹Ø©'],
                    datasets: [{
                        label: 'Ø¹Ø¯Ø¯ Ø§Ù„Ø²ÙˆØ§Ø±',
                        data: [12, 19, 3, 5, 2, 3, 15],
                        borderColor: '#0d47a1',
                        backgroundColor: 'rgba(13, 71, 161, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { display: false } }
                }
            });
        }
    </script>
</body>
</html>
