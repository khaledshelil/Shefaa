<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ© | Shefaa Admin</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --main: #0d47a1; --bg: #f4f6f9; }
        body { font-family: 'Cairo'; background: var(--bg); margin: 0; display: flex; height: 100vh; overflow: hidden; }
        
        /* Sidebar */
        .sidebar { width: 250px; background: white; padding: 20px; box-shadow: -2px 0 10px rgba(0,0,0,0.1); display: flex; flex-direction: column; }
        .brand { color: var(--main); font-size: 1.5em; font-weight: bold; margin-bottom: 30px; display: flex; align-items: center; gap: 10px; }
        .menu-item { padding: 15px; cursor: pointer; border-radius: 10px; color: #555; font-weight: 600; margin-bottom: 5px; transition: 0.3s; }
        .menu-item:hover, .menu-item.active { background: #e3f2fd; color: var(--main); }
        .menu-item i { margin-left: 10px; width: 20px; }

        /* Content */
        .content { flex: 1; padding: 30px; overflow-y: auto; }
        .card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); margin-bottom: 20px; }
        .card h3 { margin-top: 0; color: var(--main); border-bottom: 2px solid #f0f0f0; padding-bottom: 10px; }

        /* Stats */
        .stats-box { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; }
        .stat { background: white; padding: 20px; border-radius: 10px; text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .stat h2 { margin: 10px 0 0; font-size: 2.5em; color: var(--main); }

        /* Inputs */
        input, textarea, select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 10px; font-family: 'Cairo'; }
        button { padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-family: 'Cairo'; }
        .btn-save { background: var(--main); color: white; width: 100%; }
        .btn-approve { background: #27ae60; color: white; margin-left: 5px; }
        .btn-del { background: #c0392b; color: white; }

        /* Sections */
        .section { display: none; }
        .section.active { display: block; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from {opacity:0; transform:translateY(10px);} to {opacity:1; transform:translateY(0);} }
        
        /* Comment Box */
        .comment-item { border: 1px solid #eee; padding: 15px; border-radius: 8px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
        .pending { border-right: 4px solid orange; background: #fff8e1; }
        .approved { border-right: 4px solid green; }
    </style>
</head>
<body>

    <div class="sidebar">
        <div class="brand"><i class="fas fa-user-md"></i> Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</div>
        <div class="menu-item active" onclick="nav('dashboard')"><i class="fas fa-chart-line"></i> Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</div>
        <div class="menu-item" onclick="nav('website-control')"><i class="fas fa-sliders-h"></i> Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ù…ÙˆÙ‚Ø¹</div>
        <div class="menu-item" onclick="nav('add-drug')"><i class="fas fa-pills"></i> Ø¥Ø¶Ø§ÙØ© Ø¯ÙˆØ§Ø¡</div>
        <div class="menu-item" onclick="nav('comments-manage')"><i class="fas fa-comments"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª</div>
        <div class="menu-item" style="margin-top: auto; color: red;" onclick="location.href='index.html'"><i class="fas fa-sign-out-alt"></i> Ø®Ø±ÙˆØ¬</div>
    </div>

    <div class="content">
        
        <div id="dashboard" class="section active">
            <div class="stats-box">
                <div class="stat">
                    <i class="fas fa-eye fa-2x" style="color:#00bcd4"></i>
                    <h2 id="viewCount">0</h2>
                    <p>Ø²ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹</p>
                </div>
                <div class="stat">
                    <i class="fas fa-database fa-2x" style="color:#9c27b0"></i>
                    <h2 id="drugsCount">100+</h2>
                    <p>Ø§Ù„Ø£Ø¯ÙˆÙŠØ© Ø§Ù„Ù…Ø³Ø¬Ù„Ø©</p>
                </div>
            </div>
        </div>

        <div id="website-control" class="section">
            <div class="card">
                <h3>ğŸ“¢ Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø®Ø¨Ø§Ø± Ø§Ù„Ù…ØªØ­Ø±Ùƒ</h3>
                <p>Ø§ÙƒØªØ¨ Ø§Ù„Ù†Øµ Ø§Ù„Ø°ÙŠ ØªØ±ÙŠØ¯ Ø£Ù† ÙŠØ¸Ù‡Ø± ÙÙŠ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ Ù„Ù„Ù…ÙˆÙ‚Ø¹:</p>
                <textarea id="tickerText" rows="3"></textarea>
                <button class="btn-save" onclick="saveTicker()">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø´Ø±ÙŠØ· ÙÙˆØ±Ø§Ù‹ ğŸš€</button>
            </div>
        </div>

        <div id="add-drug" class="section">
            <div class="card">
                <h3>ğŸ’Š Ø¥Ø¶Ø§ÙØ© Ø¯ÙˆØ§Ø¡ Ø¬Ø¯ÙŠØ¯</h3>
                <input id="dN" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ§Ø¡">
                <input id="dP" placeholder="Ø§Ù„Ø³Ø¹Ø±" type="number">
                <input id="dA" placeholder="Ø§Ù„Ù…Ø§Ø¯Ø© Ø§Ù„ÙØ¹Ø§Ù„Ø©">
                <input id="dU" placeholder="Ø¯ÙˆØ§Ø¹ÙŠ Ø§Ù„Ø§Ø³ØªØ¹Ù…Ø§Ù„">
                <button class="btn-save" onclick="addNewDrug()">Ù†Ø´Ø± Ø§Ù„Ø¯ÙˆØ§Ø¡</button>
            </div>
        </div>

        <div id="comments-manage" class="section">
            <div class="card">
                <h3>â³ ØªØ¹Ù„ÙŠÙ‚Ø§Øª ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± (ØªØ­ØªØ§Ø¬ Ù…ÙˆØ§ÙÙ‚Ø©)</h3>
                <div id="pendingList">Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªØ¹Ù„ÙŠÙ‚Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©</div>
            </div>
            <div class="card">
                <h3>âœ… ØªØ¹Ù„ÙŠÙ‚Ø§Øª Ù…Ù†Ø´ÙˆØ±Ø©</h3>
                <div id="approvedList"></div>
            </div>
        </div>

    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, setDoc, getDoc, updateDoc, collection, addDoc, onSnapshot, deleteDoc, query, orderBy, where } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyB7cYrnnhx_eBsV3IvhAJsM0kzK_I-zpUM",
            authDomain: "sheffa-pro.firebaseapp.com",
            projectId: "sheffa-pro",
            storageBucket: "sheffa-pro.firebasestorage.app",
            messagingSenderId: "542669946824",
            appId: "1:542669946824:web:f6c0826ee500344f278afd",
            measurementId: "G-XSQ9Q08JLQ"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // --- Navigation ---
        window.nav = (id) => {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.querySelectorAll('.menu-item').forEach(i => i.classList.remove('active'));
            event.currentTarget.classList.add('active');
        }

        // --- 1. Visitor Count & Ticker Load ---
        async function loadStats() {
            // Get Visitors
            const statsDoc = await getDoc(doc(db, "settings", "general"));
            if (statsDoc.exists()) {
                document.getElementById('viewCount').innerText = statsDoc.data().visitors || 0;
                document.getElementById('tickerText').value = statsDoc.data().ticker || "";
            }
        }
        loadStats();

        // --- 2. Save Ticker ---
        window.saveTicker = async () => {
            const txt = document.getElementById('tickerText').value;
            await setDoc(doc(db, "settings", "general"), { ticker: txt }, { merge: true });
            alert("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø®Ø¨Ø§Ø± ÙÙŠ Ø§Ù„Ù…ÙˆÙ‚Ø¹! ğŸ‰");
        }

        // --- 3. Add Drug ---
        window.addNewDrug = async () => {
            const n = document.getElementById('dN').value;
            const p = document.getElementById('dP').value;
            const a = document.getElementById('dA').value;
            const u = document.getElementById('dU').value;

            if(!n) return alert("Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ§Ø¡");

            await addDoc(collection(db, "drugs"), { n, p, a, u, dose: "Ø±Ø§Ø¬Ø¹ Ø§Ù„Ø·Ø¨ÙŠØ¨", preg: "C" });
            alert("ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¯ÙˆØ§Ø¡ ÙˆØ³ÙŠØ¸Ù‡Ø± ÙÙŠ Ø§Ù„Ø¨Ø­Ø« ÙÙˆØ±Ø§Ù‹ âœ…");
            document.getElementById('dN').value = "";
        }

        // --- 4. Manage Comments ---
        // Ø¬Ù„Ø¨ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©
        const qPending = query(collection(db, "comments"), where("status", "==", "pending"));
        onSnapshot(qPending, (snap) => {
            const div = document.getElementById('pendingList');
            div.innerHTML = "";
            snap.forEach(d => {
                const data = d.data();
                div.innerHTML += `
                <div class="comment-item pending">
                    <div>
                        <strong>${data.name}</strong>: ${data.text}
                    </div>
                    <div>
                        <button class="btn-approve" onclick="approveComm('${d.id}')">Ù…ÙˆØ§ÙÙ‚Ø©</button>
                        <button class="btn-del" onclick="deleteComm('${d.id}')">Ø­Ø°Ù</button>
                    </div>
                </div>`;
            });
            if(div.innerHTML == "") div.innerHTML = "Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªØ¹Ù„ÙŠÙ‚Ø§Øª Ù…Ø¹Ù„Ù‚Ø©.";
        });

        // Ø¬Ù„Ø¨ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø©
        const qApproved = query(collection(db, "comments"), where("status", "==", "approved"));
        onSnapshot(qApproved, (snap) => {
            const div = document.getElementById('approvedList');
            div.innerHTML = "";
            snap.forEach(d => {
                const data = d.data();
                div.innerHTML += `
                <div class="comment-item approved">
                    <div><strong>${data.name}</strong>: ${data.text}</div>
                    <button class="btn-del" onclick="deleteComm('${d.id}')">Ø­Ø°Ù</button>
                </div>`;
            });
        });

        window.approveComm = async (id) => {
            await updateDoc(doc(db, "comments", id), { status: "approved" });
        }
        window.deleteComm = async (id) => {
            if(confirm("Ø­Ø°Ù Ø§Ù„ØªØ¹Ù„ÙŠÙ‚ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ")) await deleteDoc(doc(db, "comments", id));
        }

    </script>
</body>
</html>
