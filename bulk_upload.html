<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù…Ø³ØªÙˆØ±Ø¯ Ø§Ù„Ø£Ø¯ÙˆÙŠØ© Ø§Ù„Ø³Ø±ÙŠØ¹ - Shefaa</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #f4f6f9; }
        textarea { width: 100%; height: 300px; padding: 10px; border: 2px solid #0d47a1; border-radius: 10px; font-family: monospace; }
        button { background: #0d47a1; color: white; padding: 15px 30px; border: none; border-radius: 5px; cursor: pointer; font-size: 1.2em; margin-top: 10px; width: 100%; }
        button:hover { background: #1565c0; }
        #status { margin-top: 20px; font-weight: bold; }
    </style>
</head>
<body>

    <h2>ğŸ“¦ Ù…Ø³ØªÙˆØ±Ø¯ Ø§Ù„Ø£Ø¯ÙˆÙŠØ© (Bulk Uploader)</h2>
    <p>Ø§Ù†Ø³Ø® ÙƒÙˆØ¯ Ø§Ù„Ø£Ø¯ÙˆÙŠØ© (JSON) Ø§Ù„Ù„ÙŠ Ø§Ù„Ø¯ÙƒØªÙˆØ± (Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ) Ù‡ÙŠØ¨Ø¹ØªÙ‡ÙˆÙ„ÙƒØŒ ÙˆØ­Ø·Ù‡ Ù‡Ù†Ø§:</p>
    
    <textarea id="jsonInput" placeholder='[ {"n": "Drug Name", ...}, ... ]'></textarea>
    
    <button onclick="startUpload()">ğŸš€ Ø§Ø¨Ø¯Ø£ Ø±ÙØ¹ Ø§Ù„Ø£Ø¯ÙˆÙŠØ© Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
    
    <div id="status"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, setDoc, writeBatch } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ø´Ø±ÙˆØ¹Ùƒ
        const firebaseConfig = {
            apiKey: "AIzaSyB7cYrnnhx_eBsV3IvhAJsM0kzK_I-zpUM",
            authDomain: "sheffa-pro.firebaseapp.com",
            projectId: "sheffa-pro",
            storageBucket: "sheffa-pro.firebasestorage.app",
            messagingSenderId: "542669946824",
            appId: "1:542669946824:web:f6c0826ee500344f278afd",
            measurementId: "G-XSQ9Q08JLQ"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        window.startUpload = async () => {
            const input = document.getElementById('jsonInput').value;
            const status = document.getElementById('status');
            
            if(!input) { alert("Ø­Ø· Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ÙˆÙ„!"); return; }

            try {
                const drugs = JSON.parse(input); // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù†Øµ Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                status.innerHTML = `Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ ${drugs.length} Ø¯ÙˆØ§Ø¡... â³`;

                let count = 0;
                // Ø±ÙØ¹ ÙˆØ§Ø­Ø¯ Ø¨ÙˆØ§Ø­Ø¯ Ø¹Ø´Ø§Ù† Ù†Ø¶Ù…Ù† Ø§Ù„Ø¯Ù‚Ø©
                for (const d of drugs) {
                    // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ§Ø¡ ÙƒÙ€ ID Ù„Ù…Ù†Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø±
                    await setDoc(doc(db, "drugs", d.n), {
                        n: d.n,
                        p: d.p,
                        c: d.c,
                        a: d.a,
                        u: d.u,
                        dose: d.dose,
                        eff: d.eff || "Ù„Ø§ ÙŠÙˆØ¬Ø¯",
                        con: d.con || "Ø§Ù„Ø­Ø³Ø§Ø³ÙŠØ© Ù„Ù„Ù…Ø§Ø¯Ø© Ø§Ù„ÙØ¹Ø§Ù„Ø©",
                        tip: d.tip || "Ø§Ø³ØªØ´Ø± Ø§Ù„Ø·Ø¨ÙŠØ¨",
                        preg: d.preg,
                        searchKey: d.n.toLowerCase()
                    });
                    count++;
                    status.innerHTML = `ØªÙ… Ø±ÙØ¹ ${count} Ù…Ù† ${drugs.length} (${d.n})`;
                }

                status.innerHTML = `<h2 style="color:green">âœ… Ù…Ø¨Ø±ÙˆÙƒ! ØªÙ… Ø¥Ø¶Ø§ÙØ© ${count} Ø¯ÙˆØ§Ø¡ Ø¨Ù†Ø¬Ø§Ø­.</h2>`;
                document.getElementById('jsonInput').value = ''; // ØªÙØ±ÙŠØº Ø§Ù„Ø®Ø§Ù†Ø©

            } catch (e) {
                console.error(e);
                status.innerHTML = `<h2 style="color:red">âŒ ÙÙŠ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù„ÙŠ Ù†Ø³Ø®ØªÙ‡: ${e.message}</h2>`;
            }
        }
    </script>
</body>
</html>
